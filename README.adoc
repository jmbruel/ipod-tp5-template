= Design Patterns - TP5
J.-M. Bruel <jbruel@gmail.com>
v20.1 {localdate}
:tdnum: TP5
:uk:
:imagesdir: images
//------------------------- variables de configuration
// only used when master document
:icons: font
:experimental:
:numbered!:
:status:
:source-highlighter: rouge
:baseURL: :baseURL: http://bit.ly/innopolis-patterns
:github: https://github.com[GitHub]
// Specific to GitHub
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

endif::[]
//------------------------------------ 
ifdef::uk[]
:lang: uk
:lastName: LAST NAME
:firstName: First Name
:group: Group
:example: Example
:Enseignants: Teachers
:principe: Good design principle
:assignment: Assignment info
:requirements: Requirements
:initial: Initial tasks
:allerPlusLoin: Still hungry?...
:about: About...
:contrib: Contributors
endif::[]
ifndef::uk[]
:lang: fr
:lastName: NOM
:firstName: Prénom
:group: Groupe
:example: Exemple
:Enseignants: Enseignants
:principe: Principe Objet
:assignment: Informations générales
:requirements: Pré-requis
:initial: Tâche initiale
:allerPlusLoin: Pour Aller plus loin...
:about: À propos...
:contrib: Contributeurs
endif::[]
:java: https://www.java.com/fr/[Java]
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]indexterm:[AsciiDoc]
:asciidoctorlink: http://asciidoctor.org/[Asciidoctor]indexterm:[Asciidoctor]
//------------------------------------ 
:cpte: Account
:ag: BankAgency
:app: BankAgencyApp


ifndef::backend-pdf[]
//------------------------------------ Badges --------
image:https://img.shields.io/github/workflow/status/IUT-Blagnac/cpoa-tp4-template/GitHub%20Classroom%20Workflow?&logo=github-actions&logoColor=white&label=auto`grading["CI status", link="https://github.com/IUT-Blagnac/cpoa-tp4-template"]
image:https://img.shields.io/badge/License-MIT-yellow.svg[License: MIT, linkl="https://opensource.org/licenses/MIT"]
//------------------------------------ Badges --------
endif::[]

https://github.com/IUT-Blagnac/cpoa-tp4-template

:numbered:

ifdef::uk[]
== {tdnum} initial code 


This is a template for the students' assignments.

ifndef::backend-pdf[]
TIP: Course material: pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Course material: icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]
endif::[]

ifndef::uk[]
== Code initial pour le {tdnum}

ifndef::backend-pdf[]
TIP: Rappel du cours : pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Rappel du cours : icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]

endif::[]

//------------------------------------ 
== {assignment}

{lastName}:: BRUEL

{firstName}:: Jean-Michel

{group} #::

[%interactive]
- [X] {Enseignants}
- [ ] 1
- [ ] 2
- [ ] 3
- [ ] 4
- [ ] Innopolis

//------------------------------------ 
== {requirements}

ifdef::uk[]
You'll need:

[%interactive]
* [x] A {Github} account  
* [ ] A https://gitforwindows.org/[Git Bash] terminal (if you use Window$)
endif::[]
ifndef::uk[]
Il vous faut :

[%interactive]
* [x] Un compte {Github}  
* [ ] Un terminal de type https://gitforwindows.org/[Git Bash]  (si vous utilisez Window$)
endif::[]

ifdef::uk[]
[TIP]
====    
Try the following command in your terminal to check your `git` environment:
endif::[]
ifndef::uk[]
[TIP]
====    
Essayez la commande suivante dans votre terminal pour vérifier votre environnement `git` :
endif::[]

[source,shell]
....
git config --global -l
....
====

//------------------------------------ 
== {initial}

ifdef::uk[]
[%interactive]
* [x] Click on the Github Classroom link provided by your teacher (in fact, this should be done if you read this).
* [ ] Clone on your machine the Github project generated by Github Classroom.  
* [ ] Modify the README file to add your last name, first name and group number. 
* [ ] Update the badge URL so that it reflects your repo's result
* [ ] Commit and push using the following message:
endif::[]
ifndef::uk[]
[%interactive]
* [x] Clickez sur le lien Github Classroom fourni par votre enseignant (en fait c'est déjà fait si vous lisez ces lignes).
* [ ] Clonez sur votre machine le projet Github généré pour vous par Github Classroom.  
* [ ] Modifez le `README` pour modifier Nom, Prénom et Groupe. 
* [ ] Commit & push:
endif::[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #0 Initial task done
....

[IMPORTANT]
ifndef::uk[]
Dans la suite de ce document, à chaque fois que vous trouverez un énoncé commençant par `fix #...` vous devez vérifier que vos scripts/fichiers modifiés sont bien dans votre dépôt local en vue de committer et de pusher les modifications sur votre dépôt distant en utilisant comme message de commit cet énoncé.

[TIP]
====
- Si vous voulez vérifier que vous êtes prêt pour le `fix #0`, utilisez la commande : `make check`.
- Si vous voulez avoir la liste des ToDos de ce TP/TP, exécutez `make todos`.
====

endif::[]

ifdef::uk[]
In the following, every time you'll see à `fix #...` text, 
make sure all your files are committed, and then push your modifications in the distant repo, making sure you used the corresponding message (`fix #...`) in one of the `commit` messages.

[TIP]
====
- If you want to check that you're really ready for `fix #0`, you can run the command in your shell: `make check`.
- If you want to list the ToDos of the day, run `make todos`.
====

endif::[]

//------------------------------------ 
//------------------------------------ 
//------------  Let's START----------- 
//------------------------------------ 
//------------------------------------ 

:numbered!:

== Initial code

.	Get the file: link:ObserverInitialCode.zip[ObserverInitialCode.zip]. 
.	Read the content and compare the applications `observer.nonpattern` and `observer.pattern`.
.	Launch the applications (look for the 2 classes with `main()`) and observe (haha) the results.

== Exercises

=== Reverse Engineering

- Obtain and compare the 2 class diagrams for the 2 packages ()
- Place them as `TP5.plantuml` and `TP5-observer.plantuml` in the `docs` folder

You should obtain something like that:

.`observer.nonpattern`
image::TP5.svg[TP5]

.`observer.pattern`
image::TP5-observer.svg[TP5]


.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.1: Add Class Diagrams
....


=== `observer.nonpattern` code evolution

Upgrade the `observer.nonpattern` code to display the vector `CourseRecords` as a _pie chart_, in addition to the actual display (_bar chart_). 
For details on Swing pie charts, cf. <<sf,final section>>.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.2: Add Pie Chart in nonPattern
....

=== `observer.pattern` code evolution

Do the same with the `observer.pattern` code.

What do you think in terms of differences between the 2 (in terms of coding efforts and results)?

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.3: Add Pie Chart in Pattern
....

=== Push vs. Pull

You might have observed that the _Observer_ pattern was using the _pull_ method (`notifyObservers()` do not send any information).

Realize a `push` version.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.4: Add push version
....

=== Problems with the _push_

In this new version, if the programs have more than 1000 courses, and if only one evolves, `notifyObservers ()` push all the information on all the observers!

Improve your _push_ model so that it only pushes relevant data.

TIP: For this exercise, you can ignore the changes to `New Course` and continue to use the _pull_ model for this type of change.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.5: Change notify for smart push
....

=== Selecting the _updates_

You might have observed that `CourseController` is only interested in the changes of `New Course`, while  `BarChart` and `PieChart` need to be aware of the `JSlider` changes. 
Extend the registration interface of `Observable` (the` attach` method) so that `CourseController` no longer receives updates from` updates` that are not of interest to it.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.6: Add Smart attach()
....

:numbered!:

[[sf]]
== How to draw a pie chart ?


Here is a code segment that draws a pie chart given a Graphics object and 
an Array containing Integers to be represented in the pie chart. 
It is drawn at location (xOffset, yOffset) and with the radius specified to be of size 100.

[source,java]
-----
public void paint(Graphics g, Integer[] data) {
	super.paint(g);
	int radius = 100;
	
	//first compute the total number of students
	double total = 0.0;
	for (int i = 0; i < data.length; i++) {
		total += data[i];
	}
	//if total == 0 nothing to draw
	if (total != 0) {
		double startAngle = 0.0;
		for (int i = 0; i < data.length; i++) {
			double ratio = (data[i] / total) * 360.0;
			//draw the arc
			g.setColor(LayoutConstants.subjectColors[i%LayoutConstants.subjectColors.length]);
			g.fillArc(LayoutConstants.xOffset, LayoutConstants.yOffset + 300, 2 * radius, 2 * radius, (int) startAngle, (int) ratio);
			startAngle += ratio;
		}
	}
}
-----

ifndef::compact[]
//------------------------------------ 
== {contrib}
//------------------------------------ 

- mailto:jbruel@gmail.com[Jean-Michel Bruel]

== {about}

****************************************************************
Baked with {asciidoctorlink} (version `{asciidoctor-version}`) from 'Dan Allen', based on {asciidoc}.
'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::[]
